# Makefile for Docusaurus Documentation

.PHONY: help install dev build serve clean docker-dev docker-prod docker-build docker-clean test

# Default target
help:
	@echo "ğŸ“š Docusaurus Documentation - Available Commands"
	@echo ""
	@echo "Local Development:"
	@echo "  make install      - Install dependencies"
	@echo "  make dev          - Start development server"
	@echo "  make build        - Build for production"
	@echo "  make serve        - Preview production build"
	@echo "  make clean        - Clean build artifacts"
	@echo ""
	@echo "Docker Commands:"
	@echo "  make docker-dev   - Run dev server in Docker (hot reload)"
	@echo "  make docker-prod  - Run production server in Docker"
	@echo "  make docker-build - Build only (test build)"
	@echo "  make docker-clean - Clean Docker containers and images"
	@echo ""
	@echo "Testing:"
	@echo "  make test         - Run all tests"
	@echo "  make test-links   - Check for broken links"
	@echo ""

# Local development
install:
	@echo "ğŸ“¦ Installing dependencies..."
	npm install

dev:
	@echo "ğŸŒ Starting development server..."
	npm run start

build:
	@echo "ğŸ”¨ Building for production..."
	npm run build

serve:
	@echo "ğŸ‘€ Previewing production build..."
	npm run serve

clean:
	@echo "ğŸ§¹ Cleaning build artifacts..."
	rm -rf build .docusaurus node_modules/.cache
	@echo "âœ… Cleanup complete"

# Docker commands
docker-dev:
	@echo "ğŸ³ Starting Docker development server..."
	docker-compose --profile dev up

docker-dev-bg:
	@echo "ğŸ³ Starting Docker development server (background)..."
	docker-compose --profile dev up -d

docker-prod:
	@echo "ğŸ³ Building and running production Docker server..."
	docker-compose --profile prod up --build

docker-prod-bg:
	@echo "ğŸ³ Building and running production Docker server (background)..."
	docker-compose --profile prod up --build -d

docker-build:
	@echo "ğŸ³ Testing Docker build..."
	docker-compose --profile build up --build

docker-clean:
	@echo "ğŸ³ Cleaning Docker containers and images..."
	docker-compose down -v
	docker system prune -f
	@echo "âœ… Docker cleanup complete"

docker-logs:
	@echo "ğŸ“‹ Showing Docker logs..."
	docker-compose logs -f

# Testing
test: build
	@echo "âœ… Build test passed"

test-links:
	@echo "ğŸ” Checking for broken links..."
	@if command -v linkchecker >/dev/null 2>&1; then \
		npm run build && linkchecker build/index.html; \
	else \
		echo "âš ï¸  linkchecker not installed. Install with: pip install linkchecker"; \
	fi

# Deployment
deploy:
	@echo "ğŸš€ Deploying to GitHub Pages..."
	@echo "Pushing to main branch will trigger automatic deployment"
	git status

# Quick setup
setup:
	@echo "ğŸš€ Running automated setup..."
	./setup-docusaurus.sh

# All-in-one commands
quick-start: install dev

docker-quick: docker-dev

rebuild: clean install build

docker-rebuild: docker-clean docker-build
